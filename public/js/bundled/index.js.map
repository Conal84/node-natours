{"mappings":"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","sources":["public/js/mapbox.js","public/js/alerts.js","public/js/updateSettings.js","public/js/index.js","public/js/login.js","public/js/stripe.js"],"sourcesContent":["/* eslint-disable */\n\nexport const displayMap = (locations) => {\n  mapboxgl.accessToken =\n    'pk.eyJ1IjoiY29uYWw4NCIsImEiOiJja3VmdnZmeXgxeWlhMnVtb2s4dXBsdHUzIn0.oO2f_bHXq82vQ3FrnPjvBA';\n\n  var map = new mapboxgl.Map({\n    container: 'map',\n    style: 'mapbox://styles/conal84/ckulg9fhr864g17nv01833zvh',\n    scrollZoom: false,\n    // center: [-118.113491, 34.111745],\n    // zoom: 6,\n    // interactive: false\n  });\n\n  const bounds = new mapboxgl.LngLatBounds();\n\n  locations.forEach((loc) => {\n    // Create marker\n    const el = document.createElement('div');\n    el.className = 'marker';\n\n    // Add marker\n    new mapboxgl.Marker({\n      element: el,\n      anchor: 'bottom',\n    })\n      .setLngLat(loc.coordinates)\n      .addTo(map);\n\n    // Add Popup\n    new mapboxgl.Popup({ offset: 30 })\n      .setLngLat(loc.coordinates)\n      .setHTML(`<p>Day ${loc.day}: ${loc.description}</p>`)\n      .addTo(map);\n\n    // Extends map bounds to include current location\n    bounds.extend(loc.coordinates);\n  });\n\n  map.fitBounds(bounds, {\n    padding: { top: 200, bottom: 150, left: 100, right: 100 },\n  });\n};\n","/* eslint-disable */\n\nexport const hideAlert = () => {\n  const el = document.querySelector('.alert');\n  if (el) el.parentElement.removeChild(el);\n};\n\n// type is either success or error\nexport const showAlert = (type, msg) => {\n  hideAlert();\n  const markup = `<div class=\"alert alert--${type}\">${msg}</div>`;\n  document.querySelector('body').insertAdjacentHTML('afterbegin', markup);\n  window.setTimeout(hideAlert, 4000);\n};\n","/* eslint-disable */\nimport axios from 'axios';\nimport { showAlert } from './alerts';\n\n// type is either 'password' or 'data'\nexport const updateSettings = async (data, type) => {\n  try {\n    const url =\n      type === 'password'\n        ? 'api/v1/user/updateMyPassword'\n        : 'api/v1/user/updateMe';\n    const res = await axios({\n      method: 'PATCH',\n      url,\n      data,\n    });\n    if (res.data.status === 'success') {\n      showAlert('success', `${type.toUpperCase()} updated successfully!`);\n      window.setTimeout(() => {\n        location.assign('/');\n      }, 1000);\n    }\n  } catch (err) {\n    showAlert('error', err.response.data.message);\n  }\n};\n","/* eslint-disable */\nimport '@babel/polyfill';\nimport { displayMap } from './mapbox';\nimport { login } from './login';\nimport { logout } from './login';\nimport { updateSettings } from './updateSettings';\nimport { bookTour } from './stripe';\n\n// DOM ELEMENTS\nconst mapBox = document.getElementById('map');\nconst loginForm = document.querySelector('.form--login');\nconst logOutBtn = document.querySelector('.nav__el--logout');\nconst userDataForm = document.querySelector('.form-user-data');\nconst userPasswordForm = document.querySelector('.form-user-password');\nconst bookBtn = document.getElementById('book-tour');\n\nif (mapBox) {\n  const locations = JSON.parse(mapBox.dataset.locations);\n  displayMap(locations);\n}\n\nif (loginForm) {\n  loginForm.addEventListener('submit', (e) => {\n    e.preventDefault();\n    const email = document.getElementById('email').value;\n    const password = document.getElementById('password').value;\n    login(email, password);\n  });\n}\n\nif (logOutBtn) logOutBtn.addEventListener('click', logout);\n\nif (userDataForm) {\n  userDataForm.addEventListener('submit', (e) => {\n    e.preventDefault();\n    const form = new FormData();\n    form.append('name', document.getElementById('name').value);\n    form.append('email', document.getElementById('email').value);\n    form.append('photo', document.getElementById('photo').files[0]);\n\n    updateSettings(form, 'data');\n  });\n}\n\nif (userPasswordForm) {\n  userPasswordForm.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    document.querySelector('.btn--save-password').innerHTML = 'Updating...';\n    const passwordCurrent = document.getElementById('password-current').value;\n    const password = document.getElementById('password').value;\n    const passwordConfirm = document.getElementById('password-confirm').value;\n    await updateSettings(\n      { passwordCurrent, password, passwordConfirm },\n      'password'\n    );\n\n    document.querySelector('.btn--save-password').innerHTML = 'Save password';\n    document.getElementById('password-current').value = '';\n    document.getElementById('password').value = '';\n    document.getElementById('password-confirm').value = '';\n  });\n}\n\nif (bookBtn) {\n  bookBtn.addEventListener('click', (e) => {\n    e.target.textContent = 'Processing...';\n    const tourId = bookBtn.dataset.tourId;\n    bookTour(tourId);\n  });\n}\n","/* eslint-disable */\nimport axios from 'axios';\nimport { showAlert } from './alerts';\n\nexport const login = async (email, password) => {\n  try {\n    const res = await axios({\n      method: 'POST',\n      url: '/api/v1/user/login',\n      data: { email, password },\n    });\n    if (res.data.status === 'success') {\n      showAlert('success', 'Logged in successfully!');\n      window.setTimeout(() => {\n        location.assign('/');\n      }, 1500);\n    }\n  } catch (err) {\n    showAlert('error', err.response.data.message);\n  }\n};\n\nexport const logout = async () => {\n  try {\n    const res = await axios({\n      method: 'GET',\n      url: '/api/v1/user/logout',\n    });\n    if (res.data.status === 'success') location.reload(true);\n  } catch (err) {\n    showAlert('error', 'Error logging out, please try again!');\n  }\n};\n","import axios from 'axios';\nimport { showAlert } from './alerts';\n\nexport const bookTour = async (tourId) => {\n  try {\n    const stripe = Stripe(\n      'pk_test_51HqFfvAc2MU4pe32X0icUyCYG9NE7oUfAdKRM1e5TZxk5m2TceFl0XEVrOKnzkCdXY4F8ts3Prh0XXl5rXX1oSBO00KgjmaTxQ'\n    );\n\n    // 1) Get the checkout session from the server\n    const session = await axios(`/api/v1/bookings/checkout-session/${tourId}`);\n    // 2) Use stripe object to create the checkout form plus charge the bank card\n    await stripe.redirectToCheckout({\n      sessionId: session.data.session.id,\n    });\n  } catch (err) {\n    showAlert('error', err);\n  }\n};\n"],"names":["$1449e2aae815cef1$export$516836c6a9dfc573","el","document","querySelector","parentElement","removeChild","$1449e2aae815cef1$export$de026b00723010c1","type","msg","markup","insertAdjacentHTML","window","setTimeout","$6d501e6a9597d2bd$export$f558026a994b6051","async","data","url","$parcel$interopDefault","$7Gqth$axios","method","status","toUpperCase","location","assign","err","response","message","$0a984acc79c38cfe$var$mapBox","getElementById","$0a984acc79c38cfe$var$loginForm","$0a984acc79c38cfe$var$logOutBtn","$0a984acc79c38cfe$var$userDataForm","$0a984acc79c38cfe$var$userPasswordForm","$0a984acc79c38cfe$var$bookBtn","locations","mapboxgl","accessToken","map","Map","container","style","scrollZoom","bounds","LngLatBounds","forEach","loc","createElement","className","Marker","element","anchor","setLngLat","coordinates","addTo","Popup","offset","setHTML","day","description","extend","fitBounds","padding","top","bottom","left","right","$bfa9b992c563d47c$export$4c5dd147b21b9176","JSON","parse","dataset","addEventListener","e","preventDefault","email","password","$670f245a287eee1a$export$596d806903d1f59e","value","reload","form","FormData","append","files","innerHTML","passwordCurrent","passwordConfirm","target","textContent","tourId","stripe","Stripe","session","redirectToCheckout","sessionId","id","$bf47579665d4523d$export$8d5bdbf26681c0c2"],"version":3,"file":"index.js.map","sourceRoot":"../../../"}